package com.github.giwiro.database.dao

import java.sql.Connection
import com.github.giwiro.model.Product

class ProductDAO(conn: Connection) {
  def insert(product: Product): Product = {
    val q =
      """|INSERT INTO table_name (status, courier, name, url, quantity, with_box, detail, image)
         |VALUES (?, ?, ?, ?, ?, ?, ?, ?);
         |""".stripMargin
    val stmt = conn.prepareStatement(q)
    stmt.setInt(1, product.status.id)
    stmt.setInt(2, product.courier)
    stmt.setString(3, product.name)
    stmt.setString(4, product.url)
    stmt.setInt(5, product.quantity)
    stmt.setInt(6, product.withBox)
    stmt.setString(7, product.detail)
    stmt.setString(8, product.image)
    val rows: Int = stmt.executeUpdate()
    val generatedKeys = stmt.getGeneratedKeys()
    generatedKeys.next();
    val autoGeneratedID = generatedKeys.getInt(1);
    new Product(
      id = autoGeneratedID,
      status = product.status,
      courier = product.courier,
      name = product.name,
      url = product.url,
      product.quantity,
      withBox = product.withBox,
      deliveryDate = Unit,
      detail = product.detail,
      image = product.image)
  }
}
